<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediScript AI - One-Time Setup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-6">
    <div class="max-w-2xl w-full">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="bg-blue-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-rocket text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome to MediScript AI</h1>
                <p class="text-gray-600">One-time setup - Configure your FREE Groq API key</p>
            </div>

            <!-- Setup Form -->
            <div class="space-y-6">
                <!-- Step 1 -->
                <div class="bg-blue-50 border-l-4 border-blue-600 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-900 mb-2 flex items-center">
                        <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">1</span>
                        Get Your FREE Groq API Key
                    </h3>
                    <ol class="text-sm text-blue-800 space-y-2 ml-8">
                        <li>1. Visit <a href="https://console.groq.com/" target="_blank" class="underline font-semibold">console.groq.com</a></li>
                        <li>2. Sign in with Google or GitHub</li>
                        <li>3. Click "API Keys" in the left sidebar</li>
                        <li>4. Click "Create API Key"</li>
                        <li>5. Copy the key (starts with <code class="bg-blue-100 px-1 rounded">gsk_...</code>)</li>
                    </ol>
                </div>

                <!-- Step 2 -->
                <div class="bg-green-50 border-l-4 border-green-600 p-4 rounded-lg">
                    <h3 class="font-bold text-green-900 mb-3 flex items-center">
                        <span class="bg-green-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">2</span>
                        Paste Your API Key Below
                    </h3>
                    <input 
                        type="text" 
                        id="apiKeyInput" 
                        placeholder="gsk_..." 
                        class="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:border-green-600 focus:outline-none font-mono text-sm"
                    >
                </div>

                <!-- Step 3 -->
                <div class="bg-purple-50 border-l-4 border-purple-600 p-4 rounded-lg">
                    <h3 class="font-bold text-purple-900 mb-2 flex items-center">
                        <span class="bg-purple-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">3</span>
                        Save & Launch
                    </h3>
                    <button 
                        onclick="saveAndLaunch()" 
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-indigo-700 transition shadow-lg"
                    >
                        <i class="fas fa-check-circle mr-2"></i>Save API Key & Launch App
                    </button>
                </div>

                <!-- Info -->
                <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-600">
                    <p class="flex items-start">
                        <i class="fas fa-info-circle text-blue-600 mr-2 mt-0.5"></i>
                        <span>Your API key is stored securely in your browser's LocalStorage. It never leaves your device and is only used to communicate with Groq's AI service.</span>
                    </p>
                </div>

                <!-- Skip Option -->
                <div class="text-center">
                    <a href="index.html" class="text-gray-500 hover:text-gray-700 text-sm">
                        Skip setup (configure later in Settings)
                    </a>
                </div>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="mt-8 grid grid-cols-3 gap-4">
            <div class="bg-white/80 backdrop-blur rounded-lg p-4 text-center">
                <i class="fas fa-microphone text-blue-600 text-2xl mb-2"></i>
                <p class="text-xs font-semibold text-gray-700">Voice Input</p>
            </div>
            <div class="bg-white/80 backdrop-blur rounded-lg p-4 text-center">
                <i class="fas fa-robot text-purple-600 text-2xl mb-2"></i>
                <p class="text-xs font-semibold text-gray-700">AI Powered</p>
            </div>
            <div class="bg-white/80 backdrop-blur rounded-lg p-4 text-center">
                <i class="fas fa-file-pdf text-red-600 text-2xl mb-2"></i>
                <p class="text-xs font-semibold text-gray-700">PDF Export</p>
            </div>
        </div>
    </div>

    <script>
        // Check if already configured
        if (localStorage.getItem('groq_api_key')) {
            window.location.href = 'index.html';
        }

        async function saveAndLaunch() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                alert('❌ Please enter your Groq API key');
                return;
            }

            if (!apiKey.startsWith('gsk_')) {
                alert('❌ Invalid API key format. Groq API keys start with "gsk_"');
                return;
            }

            // Show loading
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Verifying API Key...';

            // Test the API key
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama-3.3-70b-versatile',
                        messages: [{ role: 'user', content: 'test' }],
                        max_tokens: 10
                    })
                });

                if (response.ok) {
                    // Save to localStorage
                    localStorage.setItem('groq_api_key', apiKey);
                    
                    // Success animation
                    btn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Success! Launching...';
                    btn.className = 'w-full bg-green-600 text-white py-4 rounded-lg font-bold text-lg';
                    
                    // Redirect to main app
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                } else {
                    throw new Error('Invalid API key');
                }
            } catch (error) {
                alert('❌ Failed to verify API key. Please check and try again.\n\nError: ' + error.message);
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Save API Key & Launch App';
            }
        }

        // Allow Enter key to submit
        document.getElementById('apiKeyInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveAndLaunch();
            }
        });
    </script>
</body>
</html>
